<!DOCTYPE html>
<html>
    <head>
        <title>FootViz - Fantasy</title>
        
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
        <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
        <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
        <style>
        /* --- Estilos Base y Layout Principal --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #1a1a2e; /* Azul oscuro de fondo */
            color: #e0e0e0;
            padding: 20px;
        }
        .dashboard-container {
            display: grid;
            grid-template-areas:
                "header header header"
                "main-left main-right main-right"
                "main-left mvp graph";
            grid-template-columns: 1fr 1fr 1fr;
            grid-template-rows: auto 1fr auto;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
            min-height: calc(100vh - 40px);
        }

        /* --- Ubicaci贸n de secciones --- */
        .fantasy-header { grid-area: header; }
        .main-left-column { grid-area: main-left; display: flex; flex-direction: column; gap: 20px; }
        
        /* ---  MODIFICACIN 1: Ligas en Paralelo --- */
        .main-right-column { 
            grid-area: main-right; 
            display: flex; 
            flex-direction: row; /* Cambiado de 'column' a 'row' */
            gap: 20px; 
        }
        /* ---  FIN DE MODIFICACIN 1  --- */

        #mvp-section { grid-area: mvp; }
        #graph-section { grid-area: graph; }

        /* --- Estilos b谩sicos para las "Tarjetas" --- */
        .card {
            background-color: #1e1e3f;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        h2, h3 { color: #ffffff; margin-bottom: 15px; }

        /* --- Estilos espec铆ficos del Header --- */
        .fantasy-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 25px;
            margin-bottom: 20px;
        }
        .user-profile-summary { display: flex; align-items: center; gap: 15px; }
        .user-level-xp { text-align: right; }
        .user-icons { display: flex; gap: 10px; font-size: 2.5rem;}
        .user-icons ion-icon { cursor: pointer; }

        /* --- Estilos de Secciones --- */
        #stadium-banner img { width: 100%; height: 150px; object-fit: cover; border-radius: 8px; margin-bottom: 10px; }
        #team-display-visual {
            position: relative; 
            height: 400px; 
            background-color: #002050; /* Verde campo */
            
            overflow: hidden;
            padding: 10px;
            display: flex;
            flex-direction: column; 
            justify-content: space-around;
        } 
        .pitch-row {
            display: flex;
            justify-content: space-around; 
            align-items: center;
        }
        .player-on-field {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            color: #ffffff;
            font-size: 0.7rem;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            padding: 5px;
            width: 60px;
        }
        .player-on-field img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #4a69ff;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
            margin-bottom: 3px;
        }
        .player-on-field.captain img {
            border-color: gold;
            box-shadow: 0 0 10px rgba(255,215,0,0.8);
        }
        
        #points-chart { max-width: 100%; background-color: #2a2a4a; border-radius: 8px; }
        .league-table table { width: 100%; text-align: center; }
        .league-table th, .league-table td { padding: 5px; }
        
        /* ---  MODIFICACIN 1.2: Ligas en Paralelo --- */
        .league-table.card {
            flex: 1; /* Hace que ambas tarjetas de liga compartan el espacio */
        }
        /* ---  FIN DE MODIFICACIN 1.2  --- */

        #fixtures-list li { list-style: none; margin-bottom: 5px; }

        /* ---  MODIFICACIN 2: Estilos para botones de acci贸n  --- */
        .card-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .card-actions button {
            flex: 1;
            background-color: #4a69ff;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        .card-actions button:hover {
            background-color: #3a58cc;
        }

        .card button:hover {
            background-color: #3a58cc;
        }
        
        #mvp-list { list-style: none; padding: 0; display: flex; flex-direction: column; gap: 15px; }
        .mvp-item { display: flex; align-items: center; gap: 10px; padding-bottom: 10px; border-bottom: 1px solid #2a2a4a; font-size: 0.9rem; }
        .mvp-item:last-child { border-bottom: none; padding-bottom: 0; }
        .mvp-rank { font-weight: 700; font-size: 1.1rem; color: #ffffff; width: 25px; text-align: center; }
        .mvp-player-img { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
        .mvp-player-info { flex-grow: 1; display: flex; align-items: center; gap: 8px; }
        .mvp-club-img { width: 24px; height: 24px; border-radius: 50%; object-fit: cover; }
        .mvp-points { font-weight: 700; font-size: 1.1rem; color: #4a69ff; }

        /* --- Responsividad --- */
        @media (max-width: 900px) {
            .dashboard-container {
                grid-template-areas:
                    "header"
                    "main-left"
                    "main-right"
                    "mvp"
                    "graph";
                grid-template-columns: 1fr;
                grid-template-rows: auto;
            }
            /* En modo tablet, las ligas vuelven a apilarse */
            .main-right-column { flex-direction: column; } 
        }
        @media (max-width: 600px) {
            .fantasy-header { flex-direction: column; gap: 10px; }
            #team-display-visual { height: 300px; } 
            .player-on-field img { width: 40px; height: 40px; }
            .player-on-field { font-size: 0.6rem; }
            .card-actions { flex-direction: column; } /* Botones uno encima de otro en m贸vil */
        }
        #profile-dropdown-menu {
            display: none; /* Oculto por defecto */
            position: absolute;
            top: 120%; /* Justo debajo del 铆cono */
            right: 0;
            width: 200px; /* Ancho del men煤 */
            padding: 10px; /* Menos padding que una card normal */
            z-index: 1000; /* Encima de todo */
        }

        .user-icons {
            position: relative; /* Contenedor padre para el men煤 */
        }

        #profile-dropdown-menu.open {
            display: block; /* Clase 'open' lo hace visible */
        }

        .menu-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-radius: 6px;
            text-decoration: none;
            color: #e0e0e0;
            font-size: 0.9rem;
            transition: background-color 0.2s;
        }
        .menu-item ion-icon {
            font-size: 1.2rem;
        }
        .menu-item:hover {
            background-color: #2a2a4a;
        }
        .menu-item.logout {
            color: #ff4d4d; /* Color rojo para cerrar sesi贸n */
        }

        .card button {
            flex: 1;
            background-color: #4a69ff;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        .chart-container {
            position: relative;
            width: 100%;
            height: 300px; /* <-- 隆LA CLAVE! Le damos una altura fija */
        }
        #points-graph-placeholder {
            /* (Para centrar el texto de "Cargando...") */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #a0a0c0;
            text-align: center;
        }
        </style>
    </head>
    <body>
        <div class="dashboard-container">

            <header class="fantasy-header">
                <div class="user-profile-summary">
                    <div class="user-level-xp"> 
                        <div>Nivel <strong id="user-level">--</strong></div>
                        <div><span id="user-xp">--</span></div>
                    </div>
                    <h2 id="username-display">Cargando...</h2>
                </div>
                <div class="user-icons">
                    <ion-icon name="trophy-outline" title="Mis Logros" onclick="window.location.href='logros.html'" > </ion-icon>
                    <ion-icon name="person-circle-outline" title="Mi Perfil" id="user-profile-btn"></ion-icon>
                    <div id="profile-dropdown-menu" class="card">
                        <a href="ayuda.html" class="menu-item">
                            <ion-icon name="help-circle-outline"></ion-icon>
                            <span>Ayuda</span>
                        </a>
                        <a href="#" id="logout-btn" class="menu-item logout">
                            <ion-icon name="log-out-outline"></ion-icon>
                            <span>Cerrar Sesi贸n</span>
                        </a>
                    </div>
                </div>
            </header>

            <div class="main-left-column">
                <section id="stadium-banner" class="card">
                    <img src="placeholder-stadium.jpg" alt="Banner Estadio">
                </section>
                <section id="my-team-section" class="card">
                    <h3>Mi Equipo</h3> 
                    <div id="team-display-visual">
                        <p id="verificar-equipo-text">Cargando equipo...</p>
                        </div>
                    <div id="team-controls" style="margin-top: 15px; text-align: center;">
                        <span>Presupuesto: <strong id="budget-remaining">-- M</strong></span> |
                        <span>Fichajes Restantes: <strong id="transfers-remaining">--</strong></span>
                        <p>Deadline: <strong id="deadline-timer">Jueves 23:59 (hora centro de Mexico)</strong></p> 
                        <button onclick="window.location.href='mi-equipo.html'" id="manage-team-button">Gestionar Equipo</button>
                    </div>
                </section>
            </div>

            <div class="main-right-column">
                
                <section id="fixtures-section" class="card">
                    <div class="card-actions">
                        <button id="view-predictions-btn" onclick="window.location.href='predicciones.html'">Predicciones</button>
                        <button id="view-leagues-btn" onclick="window.location.href='ligas.html'">Mis Ligas</button>
                        <button id="view-events-btn" onclick="window.location.href='eventos.html'">Eventos</button>
                    </div>
                    <h3>Proximos Partidos</h3> 
                    <ul id="fixtures-list">
                        <li>Cargando partidos...</li>
                    </ul>
                </section>
                <div class="league-table card" id="global-league">
                    <h3>Liga Global</h3> 
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Nombre</th>
                                <th>Pts</th>
                            </tr>
                        </thead>
                        <tbody id="global-league-ranking">
                            </tbody>
                    </table>
                </div>

                <div class="league-table card" id="local-league">
                    <h3>Liga Local </h3> 
                    <table>
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Nombre</th>
                                <th>Pts</th>
                            </tr>
                        </thead>
                        <tbody id="local-league-ranking">
                            </tbody>
                    </table>
                </div>
            </div>

            <section id="mvp-section" class="card">
                <h2>MVPs de la Jornada <span id="mvp-gameweek"></span></h2>
                <ol id="mvp-list"></ol>
            </section>
            <section id="graph-section" class="card">
                <h2>Puntuaci贸n en las 煤ltimas jornadas</h2> 
                <div class="chart-container">
                    <canvas id="points-chart"></canvas>
                    <p id="points-graph-placeholder" style="display: none;">(Gr谩fica aparecer谩 aqu铆)</p>
                </div>
            </section>

        </div>

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            const body = document.body;
            
            presupuestoRestante = document.getElementById('budget-remaining');
            fichajesRestantes = document.getElementById('transfers-remaining');
            let pointsChartInstance = null;
            function renderLeagueTable(tbodyId, rankingData, currentUserId) {
                console.log(rankingData, currentUserId);
                const tbody = document.getElementById(tbodyId);
                if (!tbody) return;
                
                tbody.innerHTML = ""; // Limpiar cualquier placeholder

                if (!rankingData || rankingData.length === 0) {
                    tbody.innerHTML = `<tr><td colspan="3" style="opacity: 0.6;">No hay datos.</td></tr>`;
                    return;
                }

                rankingData.forEach((entry, index) => {
                    const rank = index + 1;
                    // Resaltar al usuario actual
                    const isCurrentUser = entry.id_usuario === currentUserId;
                    
                    const tr = document.createElement('tr');
                    if (isCurrentUser) {
                        tr.style.backgroundColor = "rgba(74, 105, 255, 0.2)";
                        tr.style.fontWeight = "bold";
                    }
                    
                    tr.innerHTML = `
                        <td>${rank}</td>
                        <td>${entry.username}</td>
                        <td>${entry.puntos_totales}</td>
                    `;
                    tbody.appendChild(tr);
                });
            }

            function renderPointsGraph(historial) {
                const ctx = document.getElementById('points-chart').getContext('2d');
                const placeholder = document.getElementById('points-graph-placeholder');

                // RQF4 Condici贸n: Si no hay datos, mostrar placeholder
                if (!historial || historial.length === 0) {
                    console.log("No hay datos")
                    placeholder.style.display = 'block';
                    ctx.canvas.style.display = 'none';
                    
                    // L贸gica de 1 de Agosto (opcional, pero como lo pediste)
                    const hoy = new Date();
                    if (hoy.getMonth() == 7 && hoy.getDate() < 10) { // 7 es Agosto (0-11)
                        placeholder.textContent = "La temporada de predicciones a煤n no ha comenzado.";
                    } else {
                        placeholder.textContent = "隆Empieza a predecir para ver tu historial de puntos!";
                    }
                    return;
                }
                
                placeholder.style.display = 'none';
                ctx.canvas.style.display = 'block';

                let labels = [];
                let cumulativeData = [];
                let totalAcumulado = 0;

                // Calcular puntos acumulados
                historial.forEach(item => {
                    totalAcumulado = parseInt(item.puntos_jornada, 10); // Suma los puntos de esta jornada
                    labels.push(`J${item.jornada}`);
                    cumulativeData.push(totalAcumulado); // A帽ade el total acumulado
                });

                if (pointsChartInstance) {
                    pointsChartInstance.destroy(); // Destruir gr谩fico anterior si existe
                }

                

                pointsChartInstance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Puntos XP Acumulados',
                            data: cumulativeData,
                            borderColor: '#4a69ff',
                            backgroundColor: 'rgba(74, 105, 255, 0.2)',
                            fill: true,
                            tension: 0.1
                            
                        }]
                    },
                    options: {
                        responsive: true, 
                        maintainAspectRatio: false,
                        scales: { 
                            y: { 
                                ticks: { 
                                    color: '#e0e0e0' 
                                }, 
                                grid: {
                                     color: 'rgba(224, 224, 224, 0.1)' 
                                }, 
                                title: {
                                    display: true, 
                                    text: 'Puntos XP Acumulados', 
                                    color: '#e0e0e0'
                                } 
                            }, 
                            x: {
                                ticks: {
                                    color: '#e0e0e0' 
                                }, 
                                grid: {
                                    color: 'rgba(224, 224, 224, 0.1)' 
                                }, 
                                title: {
                                    display: true, 
                                    text: 'Jornada', 
                                    color: '#e0e0e0'
                                } 
                            } 
                        }, 
                        plugins: { 
                            legend: { 
                                display: false 
                            } 
                        }
                    }
                });
            }

            async function cargarDatosDashboard() { 
                try {
                    const response = await fetch('/api/fantasy-dashboard'); 

                    if (response.status === 401 || response.status === 403) {
                        alert("Tu sesi贸n ha expirado. Por favor, inicia sesi贸n de nuevo.");
                        window.location.href = '/login.html'; 
                        return;
                    }

                    if (!response.ok) {
                        throw new Error('Error al cargar los datos del dashboard.');
                    }
                    
                    const data = await response.json();
                    userData = data.userData;
                    username = document.getElementById('username-display');
                    username.innerHTML =`${userData.username}`;
                    userXp = document.getElementById('user-xp');
                    userXp.innerHTML = `${userData.xp_total} XP`;
                    nivel = document.getElementById('user-level');
                    nivel.innerHTML = `${userData.nivel}`;

                    equipoData = data.equipoData;
                    textoVerifiacion = document.getElementById('verificar-equipo-text');
                    botonManejador = document.getElementById('manage-team-button');
                    const teamDisplayVisual = document.getElementById('team-display-visual'); 
                    if (equipoData) {
                        textoVerifiacion.style.display = 'none';
                        botonManejador.innerHTML = "Gestionar Equipo";
                        botonManejador.onclick = function() { window.location.href='mi-equipo.html' };
                        presupuestoRestante.innerHTML=`$${equipoData.presupuesto_restante}M`;
                        fichajesRestantes.innerHTML=`${equipoData.fichajes_jornada_restantes}`;

                        if (data.plantillaConDetalles && data.plantillaConDetalles.length > 0) {
                            renderizarPlantillaEnCampo(data.plantillaConDetalles, teamDisplayVisual);
                        } else {
                            teamDisplayVisual.innerHTML = "<p style='color:#fff; text-align:center;'>No hay jugadores en tu plantilla titular.</p>";
                        }

                    } else {
                        textoVerifiacion.style.display = 'block'; 
                        textoVerifiacion.innerHTML = "A煤n no has creado un equipo.";
                        botonManejador.innerHTML = "Crear Equipo";
                        botonManejador.onclick = function() { window.location.href='crear-equipo.html' };
                        presupuestoRestante.innerHTML = "N/A";
                        fichajesRestantes.innerHTML = "N/A";
                        teamDisplayVisual.innerHTML = "<p style='color:#fff; text-align:center;'>Accede a Crear Equipo</p>";
                    }

                    

                    const currentUserId = userData ? userData.id_usuario : null;
                    renderLeagueTable('global-league-ranking', data.globalRanking, currentUserId);
                    renderLeagueTable('local-league-ranking', data.localRanking, currentUserId);
                    
                    renderPointsGraph(data.historialPredicciones);
                    


                } catch (error) {
                    console.error("Error:", error);
                }

                
                
            } 

            function renderizarPlantillaEnCampo(plantilla, container) {
                container.innerHTML = ''; 

                const titulares = plantilla.filter(p => p.es_titular === 1);

                if (titulares.length === 0) {
                    container.innerHTML = "<p style='color:#fff; text-align:center;'>No hay jugadores titulares en tu plantilla.</p>";
                    return;
                }

                const rowG = document.createElement('div');
                rowG.className = 'pitch-row';
                rowG.id = 'pitch-row-G'; 
                const rowD = document.createElement('div');
                rowD.className = 'pitch-row';
                rowD.id = 'pitch-row-D'; 

                const rowM = document.createElement('div');
                rowM.className = 'pitch-row';
                rowM.id = 'pitch-row-M'; 

                const rowF = document.createElement('div');
                rowF.className = 'pitch-row';
                rowF.id = 'pitch-row-F'; 
                
                container.appendChild(rowF); 
                container.appendChild(rowM);
                container.appendChild(rowD);
                container.appendChild(rowG); 

                titulares.forEach(player => {
                    let targetRow;
                    
                    switch(player.posicion) {
                        case 'G': targetRow = rowG; break;
                        case 'D': targetRow = rowD; break;
                        case 'M': targetRow = rowM; break;
                        case 'F': targetRow = rowF; break;
                        default:  targetRow = rowM; 
                    }

                    const playerDiv = document.createElement('div');
                    playerDiv.classList.add('player-on-field');
                    
                    if (player.es_capitan === 1) {
                        playerDiv.classList.add('captain');
                    }

                    const playerImgSrc = player.url_imagen_jugador || 'placeholder-player-face.png';
                    
                    const firstName = player.nombre_jugador; 

                    playerDiv.innerHTML = `
                        <img src="${playerImgSrc}" alt="${player.nombre_jugador}">
                        <span>${firstName}</span> 
                    `;
                    targetRow.appendChild(playerDiv);
                });
            }

            function cargarProximosPartidos() {
                const fixturesList = document.getElementById('fixtures-list');
    
                fetch(`/api/fantasy/proximos-partidos`)
                    .then(res => {
                        if (!res.ok) throw new Error('Error al cargar pr贸ximos partidos');
                        return res.json();
                    })
                    .then(data => {
                        fixturesList.innerHTML = ""; 

                        if (data.length === 0) {
                            fixturesList.innerHTML = "<li>No hay partidos programados.</li>";
                            return;
                        }

                        
                        

                        data.forEach(partido => {
                            const li = document.createElement('li');
                            
                            li.style.display = 'flex';
                            li.style.alignItems = 'center';
                            li.style.justifyContent = 'center';
                            li.style.gap = '10px';
                            li.style.padding = '5px 0';

                            li.dataset.partidoId = partido.id_partido; 
                            
                            li.innerHTML = `
                                <span style="display: flex; align-items: center; gap: 8px;">
                                    <img src="${partido.escudo_local}" alt="${partido.nombre_local}" style="width: 24px; height: 24px; border-radius: 50%;">
                                    ${partido.nombre_local}
                                </span>
                                <span style="font-weight: 600;">vs</span>
                                <span style="display: flex; align-items: center; gap: 8px;">
                                    ${partido.nombre_visitante}
                                    <img src="${partido.escudo_visitante}" alt="${partido.nombre_visitante}" style="width: 24px; height: 24px; border-radius: 50%;">
                                </span>
                            `;
                            fixturesList.appendChild(li);
                        });
                    })
                    .catch(err => {
                        console.error("Error cargando pr贸ximos partidos:", err);
                        fixturesList.innerHTML = "<li>Error al cargar partidos.</li>";
                    });
            }

            function cargarMVP() {
                const mvpList = document.getElementById('mvp-list'); 

                fetch(`/api/fantasy/mvp-de-la-jornada`)
                .then(res => {
                    if (!res.ok) throw new Error('Error al cargar MVP');
                    return res.json();
                })
                .then(data => {
                    mvpList.innerHTML = ""; 

                    if (data.length === 0) {
                        mvpList.innerHTML = "<p>A煤n no disponible.</p>"; 
                        return; 
                    }
                    
                    data.forEach((player, index) => {
                        const li = document.createElement('li');
                        li.classList.add('mvp-item'); 

                        li.innerHTML = `
                            <span class="mvp-rank">${index + 1}</span>
                            <img src="${player.url_imagen_jugador || 'placeholder-player-face.png'}" alt="${player.nombre_jugador}" class="mvp-player-img">
                            <div class="mvp-player-info">
                                <span class="mvp-player-name">${player.nombre_jugador}</span>
                                <img src="${player.img_equipo}" alt="${player.nombre_equipo}" class="mvp-club-img" title="${player.nombre_equipo}">
                            </div>
                            <span class="mvp-points">${player.puntos_fantasy} Pts</span>
                        `;
                        mvpList.appendChild(li);
                    });

                    const nextGameweekEl = document.getElementById('current-gameweek-fixtures');
                    
                })
                .catch(err => {
                    console.error("Error cargando MVP:", err);
                    mvpList.innerHTML = "<li>Error al cargar.</li>";
                });
            }

            
            cargarDatosDashboard();
            cargarMVP();
            cargarProximosPartidos();

            const profileBtn = document.getElementById('user-profile-btn');
            const profileDropdown = document.getElementById('profile-dropdown-menu');

            // 1. L贸gica para abrir/cerrar el men煤
            profileBtn.addEventListener('click', (event) => {
                console.log("Click");
                event.stopPropagation(); // Evita que el clic se propague al 'window'
                profileDropdown.classList.toggle('open');
            });

            // 2. L贸gica para cerrar el men煤 si se hace clic fuera
            window.addEventListener('click', (event) => {
                if (profileDropdown.classList.contains('open')) {
                    // Si el clic NO fue dentro del men煤 Y NO fue en el bot贸n
                    if (!profileDropdown.contains(event.target) && event.target !== profileBtn) {
                        profileDropdown.classList.remove('open');
                    }
                }
            });

            // 3. L贸gica de Cerrar Sesi贸n
            const logoutBtn = document.getElementById('logout-btn');
            logoutBtn.addEventListener('click', async (event) => {
                event.preventDefault(); // Prevenir que el link '#' navegue
                
                try {
                    // Llama al endpoint de logout que invalida la cookie/token
                    const response = await fetch('/api/logout', { method: 'POST' });

                    if (response.ok) {
                        alert("Has cerrado sesi贸n. 隆Vuelve pronto!");
                        window.location.href = '/login.html'; // Redirigir al login
                    } else {
                        throw new Error('No se pudo cerrar sesi贸n.');
                    }
                } catch (error) {
                    console.error("Error al cerrar sesi贸n:", error);
                    alert("Sesion Cerrada");
                    // (Igual lo redirigimos por si el token ya expir贸)
                    window.location.href = '/login.html';
                }
            });
            
        </script>

    </body>
</html>